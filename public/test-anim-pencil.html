<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pencil Tracer</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000;
            overflow: hidden;
            cursor: none;
            font-family: Arial, sans-serif;
        }

        .wrapper {
          position: absolute;
            top: 0;
            left: 0;
            width: 500px;
            height: 500px;
            border: 1px solid red;
        }

        #pencil {
            position: absolute;
            width: 60px;
            height: 200px;
            pointer-events: none;
            z-index: 1000;
            transform-origin: 30px 180px;
            transition: transform 0.1s ease-out;
        }

        .trail-point {
            position: absolute;
            width: 5px;
            height: 5px;
            background: #fff;
            border-radius: 50%;
            pointer-events: none;
            z-index: 999;
        }

        .instructions {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #34495e;
            font-size: 14px;
            z-index: 1001;
            background: rgba(255, 255, 255, 0.8);
            padding: 10px 15px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }

        .controls {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 1001;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }

        .controls button {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 16px;
            margin: 0 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .controls button:hover {
            background: #2980b9;
        }

        .controls button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }

        #svgPath {
            position: absolute;
            top: 0;
            left: 0;
            width: 500px;
            height: 500px;
            pointer-events: none;
            z-index: 998;
        }

        .path-preview {
            fill: none;
            stroke: #ecf0f1;
            stroke-width: 2;
            stroke-dasharray: 5,5;
            opacity: 0;
        }
    </style>
</head>
<body>
  <div class="wrapper">

    <div class="instructions">
        Watch the pencil follow the predetermined path!
    </div>
    
    <div class="controls">
        <button id="startBtn">Start Animation</button>
        <button id="pauseBtn" disabled>Pause</button>
        <button id="resetBtn">Reset</button>
        <button id="changePathBtn">Change Path</button>
    </div>

    <!-- SVG for path preview -->
    <svg id="svgPath" viewBox="0 0 100 100" preserveAspectRatio="none">
        <path id="pathPreview" class="path-preview" d="M10,50 Q30,10 50,50 T90,50"/>
    </svg>
    
    <svg id="pencil" viewBox="0 0 60 200">
        <!-- Pencil body -->
        <rect x="20" y="20" width="20" height="140" fill="#f39c12" stroke="#e67e22" stroke-width="1"/>
        
        <!-- Pencil tip (wood) -->
        <polygon points="20,160 40,160 30,180" fill="#d4a574" stroke="#c19654" stroke-width="1"/>
        
        <!-- Pencil lead -->
        <polygon points="28,180 32,180 30,190" fill="#2c3e50"/>
        
        <!-- Metal ferrule -->
        <rect x="18" y="10" width="24" height="15" fill="#bdc3c7" stroke="#95a5a6" stroke-width="1"/>
        
        <!-- Eraser -->
        <ellipse cx="30" cy="7" rx="12" ry="7" fill="#e74c3c" stroke="#c0392b" stroke-width="1"/>
        
        <!-- Pencil brand text -->
        <text x="30" y="90" text-anchor="middle" font-family="Arial" font-size="8" fill="#e67e22">#2</text>
        
        <!-- Wood texture lines -->
        <line x1="22" y1="30" x2="22" y2="150" stroke="#e67e22" stroke-width="0.5" opacity="0.6"/>
        <line x1="38" y1="30" x2="38" y2="150" stroke="#e67e22" stroke-width="0.5" opacity="0.6"/>
    </svg>
  </div>


    <script>
        const pencil = document.getElementById('pencil');
        const body = document.body;
        const pathPreview = document.getElementById('pathPreview');
        const startBtn = document.getElementById('startBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const resetBtn = document.getElementById('resetBtn');
        const changePathBtn = document.getElementById('changePathBtn');
        
        let trailPoints = [];
        let animationId;
        let isAnimating = false;
        let currentPathIndex = 0;
        let progress = 0;
        
        // Predefined SVG paths (as percentages of screen size)
        const paths = [
            "M10,50 Q30,10 50,50 T90,50", // Smooth wave
            "M20,20 L80,20 L80,80 L20,80 Z", // Rectangle
            "M50,10 L90,90 L10,90 Z", // Triangle
            "M50,50 m-30,0 a30,30 0 1,0 60,0 a30,30 0 1,0 -60,0", // Circle
            "M10,80 Q25,20 40,50 Q55,80 70,40 Q85,10 100,60", // Complex curve
            "M20,50 C20,20 40,20 50,50 C60,80 80,80 80,50" // Heart-like curve
        ];
        
        let currentPath = paths[currentPathIndex];

        function percentToPixel(pathString) {
            return pathString.replace(/(\d+(?:\.\d+)?)/g, (match) => {
                const percent = parseFloat(match);
                // Assume X coordinates use window width, Y coordinates use window height
                return (percent * (pathString.indexOf(match) % 2 === 0 ? window.innerWidth : window.innerHeight) / 150).toString();
            });
        }

        function getPointOnPath(path, progress) {
            const tempPath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            tempPath.setAttribute('d', path);
            const length = tempPath.getTotalLength();
            const point = tempPath.getPointAtLength(length * progress);
            
            // Calculate tangent for rotation
            const tangentPoint1 = tempPath.getPointAtLength(Math.max(0, length * progress - 1));
            const tangentPoint2 = tempPath.getPointAtLength(Math.min(length, length * progress + 1));
            const angle = Math.atan2(tangentPoint2.y - tangentPoint1.y, tangentPoint2.x - tangentPoint1.x) * (180 / Math.PI);
            
            return { x: point.x, y: point.y, angle: angle };
        }

        function createTrailPoint(x, y) {
            const point = document.createElement('div');
            point.className = 'trail-point';
            point.style.left = (x - 1.5) + 'px';
            point.style.top = (y - 1.5) + 'px';
            point.style.opacity = '1';
            
            body.appendChild(point);
            
            trailPoints.push({
                element: point,
                timestamp: Date.now(),
                opacity: 1
            });
            
            if (trailPoints.length > 200) {
                const oldPoint = trailPoints.shift();
                if (oldPoint.element.parentNode) {
                    oldPoint.element.parentNode.removeChild(oldPoint.element);
                }
            }
        }

        function updateTrail() {
            const currentTime = Date.now();
            
            trailPoints.forEach((point, index) => {
                const age = currentTime - point.timestamp;
                const maxAge = 800;
                
                if (age > maxAge) {
                    if (point.element.parentNode) {
                        point.element.parentNode.removeChild(point.element);
                    }
                    trailPoints.splice(index, 1);
                } else {
                    const opacity = Math.max(0, 1 - (age / maxAge));
                    point.element.style.opacity = opacity;
                    
                    const scale = Math.max(0.3, 1 - (age / maxAge) * 0.7);
                    point.element.style.transform = `scale(${scale})`;
                }
            });
            
            requestAnimationFrame(updateTrail);
        }

        function animate() {
            if (!isAnimating) return;
            
            const pixelPath = percentToPixel(currentPath);
            const pathInfo = getPointOnPath(pixelPath, progress);
            
            // Position pencil
            pencil.style.left = (pathInfo.x - 30) + 'px';
            pencil.style.top = (pathInfo.y - 180) + 'px';
            pencil.style.transform = `rotate(${pathInfo.angle + 90}deg)`;
            
            // Create trail point
            createTrailPoint(pathInfo.x, pathInfo.y);
            
            // Update progress
            progress += 0.005; // Speed of animation
            
            if (progress >= 1) {
                progress = 0; // Loop the animation
            }
            
            animationId = requestAnimationFrame(animate);
        }

        function startAnimation() {
            if (!isAnimating) {
                isAnimating = true;
                startBtn.disabled = true;
                pauseBtn.disabled = false;
                animate();
            }
        }

        function pauseAnimation() {
            isAnimating = false;
            startBtn.disabled = false;
            pauseBtn.disabled = true;
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
        }

        function resetAnimation() {
            pauseAnimation();
            progress = 0;
            
            // Clear trail
            trailPoints.forEach(point => {
                if (point.element.parentNode) {
                    point.element.parentNode.removeChild(point.element);
                }
            });
            trailPoints = [];
            
            // Reset pencil position
            const pixelPath = percentToPixel(currentPath);
            const pathInfo = getPointOnPath(pixelPath, 0);
            pencil.style.left = (pathInfo.x - 30) + 'px';
            pencil.style.top = (pathInfo.y - 180) + 'px';
            pencil.style.transform = `rotate(${pathInfo.angle + 90}deg)`;
        }

        function changePath() {
            pauseAnimation();
            currentPathIndex = (currentPathIndex + 1) % paths.length;
            currentPath = paths[currentPathIndex];
            pathPreview.setAttribute('d', currentPath);
            resetAnimation();
        }

        // Event listeners
        startBtn.addEventListener('click', startAnimation);
        pauseBtn.addEventListener('click', pauseAnimation);
        resetBtn.addEventListener('click', resetAnimation);
        changePathBtn.addEventListener('click', changePath);

        // Initialize
        updateTrail();
        pathPreview.setAttribute('d', currentPath);
        resetAnimation();

        // Handle window resize
        window.addEventListener('resize', () => {
            if (isAnimating) {
                pauseAnimation();
                setTimeout(() => {
                    resetAnimation();
                }, 100);
            }
        });
    </script>
</body>
</html>